var Formstone=this.Formstone=function(c,d,l,n){function t(e,k,a,b){var c={raw:{}},f;b=b||{};for(f in b)b.hasOwnProperty(f)&&("classes"===e?(c.raw[b[f]]=k+"-"+b[f],c[b[f]]="."+k+"-"+b[f]):(c.raw[f]=b[f],c[f]=b[f]+"."+k));for(f in a)a.hasOwnProperty(f)&&("classes"===e?(c.raw[f]=a[f].replace(/{ns}/g,k),c[f]=a[f].replace(/{ns}/g,"."+k)):(c.raw[f]=a[f].replace(/.{ns}/g,""),c[f]=a[f].replace(/{ns}/g,k)));return c}function u(){a.windowWidth=a.$window.width();a.windowHeight=a.$window.height();v=m.startTimer(v,
20,w)}function w(){for(var e in a.ResizeHandlers)a.ResizeHandlers.hasOwnProperty(e)&&a.ResizeHandlers[e].callback.call(d,a.windowWidth,a.windowHeight)}function x(e,a){return parseInt(e.priority)-parseInt(a.priority)}n=function(){this.Plugins={};this.ResizeHandlers=[];this.window=d;this.$window=c(d);this.document=l;this.$document=c(l);this.$body=null;this.windowHeight=this.windowWidth=0;this.userAgent=d.navigator.userAgent||d.navigator.vendor||d.opera;this.isFirefox=/Firefox/i.test(this.userAgent);
this.isChrome=/Chrome/i.test(this.userAgent);this.isSafari=/Safari/i.test(this.userAgent)&&!this.isChrome;this.isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(this.userAgent);this.isFirefoxMobile=this.isFirefox&&this.isMobile;this.transition=this.transform=null;this.support={file:!!(d.File&&d.FileList&&d.FileReader),history:!!(d.history&&d.history.pushState&&d.history.replaceState),matchMedia:!(!d.matchMedia&&!d.msMatchMedia),raf:!(!d.requestAnimationFrame||!d.cancelAnimationFrame),touch:!!("ontouchstart"in
d||d.DocumentTouch&&l instanceof d.DocumentTouch),transition:!1,transform:!1}};var m={killEvent:function(a,c){try{a.preventDefault(),a.stopPropagation(),c&&a.stopImmediatePropagation()}catch(d){}},startTimer:function(a,c,d,b){m.clearTimer(a);return b?setInterval(d,c):setTimeout(d,c)},clearTimer:function(a,c){a&&(c?clearInterval(a):clearTimeout(a))},sortAsc:function(a,c){return parseInt(c)-parseInt(a)},sortDesc:function(a,c){return parseInt(c)-parseInt(a)}},a=new n,y={base:"{ns}",element:"{ns}-element"},
h={namespace:".{ns}",blur:"blur.{ns}",change:"change.{ns}",click:"click.{ns}",dblClick:"dblclick.{ns}",drag:"drag.{ns}",dragEnd:"dragend.{ns}",dragEnter:"dragenter.{ns}",dragLeave:"dragleave.{ns}",dragOver:"dragover.{ns}",dragStart:"dragstart.{ns}",drop:"drop.{ns}",error:"error.{ns}",focus:"focus.{ns}",focusIn:"focusin.{ns}",focusOut:"focusout.{ns}",input:"input.{ns}",keyDown:"keydown.{ns}",keyPress:"keypress.{ns}",keyUp:"keyup.{ns}",load:"load.{ns}",mouseDown:"mousedown.{ns}",mouseEnter:"mouseenter.{ns}",
mouseLeave:"mouseleave.{ns}",mouseMove:"mousemove.{ns}",mouseOut:"mouseout.{ns}",mouseOver:"mouseover.{ns}",mouseUp:"mouseup.{ns}",resize:"resize.{ns}",scroll:"scroll.{ns}",select:"select.{ns}",touchCancel:"touchcancel.{ns}",touchEnd:"touchend.{ns}",touchLeave:"touchleave.{ns}",touchMove:"touchmove.{ns}",touchStart:"touchstart.{ns}"};n.prototype.Plugin=function(e,k){a.Plugins[e]=function(e,b){function k(a){var d="object"===c.type(a);a=c.extend(!0,{},b.defaults||{},d?a:{});for(var g=0,l=this.length;g<
l;g++){var p=this.eq(g);if(!f(p)){var h=p.data(e+"-options"),h=c.extend(!0,{$el:p},a,"object"===c.type(h)?h:{});p.addClass(b.classes.raw.element).data(r,h);b.methods._construct.apply(p,[h].concat(Array.prototype.slice.call(arguments,d?1:0)))}}return this}function f(a){return a.data(r)}function l(a){if(this instanceof c){var e=b.methods[a];return"object"!==c.type(a)&&a?e&&0!==a.indexOf("_")?b.functions.iterate.apply(this,[e].concat(Array.prototype.slice.call(arguments,1))):this:k.apply(this,arguments)}}
function g(a){var e=b.utilities[a]||b.utilities._initialize||!1;if(e)return e.apply(d,Array.prototype.slice.call(arguments,"object"===c.type(a)?0:1))}var r="fs-"+e;b.initialized=!1;b.priority=b.priority||10;b.classes=t("classes",r,y,b.classes);b.events=t("events",e,h,b.events);b.functions=c.extend({getData:f,iterate:function(a){for(var b=0,e=this.length;b<e;b++){var d=this.eq(b),g=f(d)||{};"undefined"!==c.type(g.$el)&&a.apply(d,[g].concat(Array.prototype.slice.call(arguments,1)))}return this}},m,
b.functions);b.methods=c.extend(!0,{_setup:c.noop,_construct:c.noop,_destruct:c.noop,_resize:!1,destroy:function(a){b.functions.iterate.apply(this,[b.methods._destruct].concat(Array.prototype.slice.call(arguments,1)));this.removeClass(b.classes.raw.element).removeData(r)}},b.methods);b.utilities=c.extend(!0,{_initialize:!1,_delegate:!1,defaults:function(a){b.defaults=c.extend(!0,b.defaults,a||{})}},b.utilities);b.widget&&(c.fn[e]=l);c[e]=b.utilities._delegate||g;b.namespace=e;b.methods._resize&&(a.ResizeHandlers.push({namespace:e,
priority:b.priority,callback:b.methods._resize}),a.ResizeHandlers.sort(x));return b}(e,k);return a.Plugins[e]};var v=null;a.$window.on("resize.fs",u);u();c(function(){a.$body=c("body");for(var e in a.Plugins)a.Plugins.hasOwnProperty(e)&&!a.Plugins[e].initialized&&(a.Plugins[e].methods._setup.call(l),a.Plugins[e].initialized=!0)});h.clickTouchStart=h.click+" "+h.touchStart;(function(){var c={transition:"transitionend",MozTransition:"transitionend",OTransition:"otransitionend",WebkitTransition:"webkitTransitionEnd"},
d=["transition","-webkit-transition"],q={transform:"transform",MozTransform:"-moz-transform",OTransform:"-o-transform",msTransform:"-ms-transform",webkitTransform:"-webkit-transform"},b="transitionend",n="",f="",m=l.createElement("div"),g;for(g in c)if(c.hasOwnProperty(g)&&g in m.style){b=c[g];a.support.transition=!0;break}h.transitionEnd=b+".{ns}";for(g in d)if(d.hasOwnProperty(g)&&d[g]in m.style){n=d[g];break}a.transition=n;for(g in q)if(q.hasOwnProperty(g)&&q[g]in m.style){a.support.transform=
!0;f=q[g];break}a.transform=f})();return a}(jQuery,this,document);
(function(n,u,h){function k(b){b.preventManipulation&&b.preventManipulation();var a=b.data,c=b.originalEvent;if(c.type.match(/(up|end)$/i))v(b);else{if(c.pointerId){var f=!1,g;for(g in a.touches)a.touches[g].id===c.pointerId&&(f=!0,a.touches[g].pageX=c.clientX,a.touches[g].pageY=c.clientY);f||a.touches.push({id:c.pointerId,pageX:c.clientX,pageY:c.clientY})}else a.touches=c.touches;c.type.match(/(down|start)$/i)?w(b):c.type.match(/move$/i)&&z(b)}}function w(b){var a=b.data,e="undefined"!==n.type(a.touches)?
a.touches[0]:null;a.touching||(a.startE=b.originalEvent,a.startX=e?e.pageX:b.pageX,a.startY=e?e.pageY:b.pageY,a.startT=(new Date).getTime(),a.scaleD=1,a.passed=!1);if(a.tap)a.clicked=!1,a.$el.on([c.touchMove,c.pointerMove].join(" "),a,k).on([c.touchEnd,c.touchCancel,c.pointerUp,c.pointerCancel].join(" "),a,k);else if(a.pan||a.scale){a.$links&&a.$links.off(c.click);b=r(a.scale?c.scaleStart:c.panStart,b,a.startX,a.startY,a.scaleD,0,0,"","");if(a.scale&&a.touches&&2<=a.touches.length){var f=a.touches,
e=(f[0].pageX+f[1].pageX)/2,g=(f[0].pageY+f[1].pageY)/2,d;d=f[1].pageX-f[0].pageX;f=f[1].pageY-f[0].pageY;d=Math.sqrt(d*d+f*f);a.pinch={startX:e,startY:g,startD:d};b.pageX=a.startX=a.pinch.startX;b.pageY=a.startY=a.pinch.startY}if(!a.touching){a.touching=!0;if(a.pan)x.on(c.mouseMove,a,z).on(c.mouseUp,a,v);x.on([c.touchMove,c.touchEnd,c.touchCancel,c.pointerMove,c.pointerUp,c.pointerCancel].join(" "),a,k);a.$el.trigger(b)}}}function z(b){var a=b.data,e="undefined"!==n.type(a.touches)?a.touches[0]:
null,f=e?e.pageX:b.pageX,g=e?e.pageY:b.pageY,d=f-a.startX,l=g-a.startY,h=0<d?"right":"left",p=0<l?"down":"up",e=Math.abs(d)>y,q=Math.abs(l)>y;if(a.tap)(e||q)&&a.$el.off([c.touchMove,c.touchEnd,c.touchCancel,c.pointerMove,c.pointerUp,c.pointerCancel].join(" "));else if(a.pan||a.scale)!a.passed&&a.axis&&(a.axisX&&q||a.axisY&&e)?v(b):(!a.passed&&(!a.axis||a.axis&&a.axisX&&e||a.axisY&&q)&&(a.passed=!0),a.passed&&(t.killEvent(b),t.killEvent(a.startE)),e=!0,b=r(a.scale?c.scale:c.pan,b,f,g,a.scaleD,d,l,
h,p),a.scale&&(a.touches&&2<=a.touches.length?(d=a.touches,a.pinch.endX=(d[0].pageX+d[1].pageX)/2,a.pinch.endY=(d[0].pageY+d[1].pageY)/2,f=a.pinch,g=d[1].pageX-d[0].pageX,d=d[1].pageY-d[0].pageY,g=Math.sqrt(g*g+d*d),f.endD=g,a.scaleD=a.pinch.endD/a.pinch.startD,b.pageX=a.pinch.endX,b.pageY=a.pinch.endY,b.scale=a.scaleD,b.deltaX=a.pinch.endX-a.pinch.startX,b.deltaY=a.pinch.endY-a.pinch.startY):a.pan||(e=!1)),e&&a.$el.trigger(b))}function C(b){t.killEvent(b,!0);b.data.$links.off(c.click)}function v(b){var a=
b.data;if(a.tap)a.$el.off([c.touchMove,c.touchEnd,c.touchCancel,c.pointerMove,c.pointerUp,c.pointerCancel,c.mouseMove,c.mouseUp].join(" ")),a.startE.preventDefault(),A(b);else if(a.pan||a.scale){var e="undefined"!==n.type(a.touches)?a.touches[0]:null,f=e?e.pageX:b.pageX,e=e?e.pageY:b.pageY,g=f-a.startX,d=e-a.startY,l=(new Date).getTime(),h=a.scale?c.scaleEnd:c.panEnd,p=0<g?"right":"left",q=0<d?"down":"up",k=1<Math.abs(g),m=1<Math.abs(d);a.swipe&&Math.abs(g)>y&&l-a.startT<D&&(h=c.swipe);if(a.axis&&
(a.axisX&&m||a.axisY&&k)||k||m)for(a.$links=a.$el.find("a"),l=0,k=a.$links.length;l<k;l++)m=a.$links.eq(l),m.on(c.click,a,C),m=n._data(m[0],"events").click,m.unshift(m.pop());b=r(h,b,f,e,a.scaleD,g,d,p,q);x.off([c.touchMove,c.touchEnd,c.touchCancel,c.mouseMove,c.mouseUp,c.pointerMove,c.pointerUp,c.pointerCancel].join(" "));a.$el.trigger(b);a.touches=[]}a.touching=!1}function A(b){t.killEvent(b);var a=b.data;a.clicked||("click"!==b.type&&(a.clicked=!0),b=r(c.tap,b.originalEvent,a.startE?a.startX:b.pageX,
a.startE?a.startY:b.pageY,1,0,0),a.$el.trigger(b))}function r(b,a,c,f,g,d,h,k,p){return n.Event(b,{originalEvent:a,bubbles:!0,pageX:c,pageY:f,scale:g,deltaX:d,deltaY:h,directionX:k,directionY:p})}function B(b,a){b.css({"-ms-touch-action":a,"touch-action":a})}h=!u.window.PointerEvent;h=u.Plugin("touch",{widget:!0,defaults:{axis:!1,pan:!1,scale:!1,swipe:!1,tap:!1},methods:{_construct:function(b){b.touches=[];b.touching=!1;if(b.tap)b.pan=!1,b.scale=!1,b.swipe=!1,this.on([c.touchStart,c.pointerDown].join(" "),
b,w).on(c.click,b,A);else if(b.pan||b.swipe||b.scale)if(b.tap=!1,b.swipe&&(b.pan=!0),b.scale&&(b.axis=!1),b.axis?(b.axisX="x"===b.axis,b.axisY="y"===b.axis):B(this,"none"),this.on([c.touchStart,c.pointerDown].join(" "),b,k),b.pan)this.on(c.mouseDown,b,w)},_destruct:function(b){B(this.off(c.namespace),"")}},events:{pointerDown:h?"MSPointerDown":"pointerdown",pointerUp:h?"MSPointerUp":"pointerup",pointerMove:h?"MSPointerMove":"pointermove",pointerCancel:h?"MSPointerCancel":"pointercancel"}});var c=
h.events,t=h.functions,x=u.$window,y=5,D=200;c.tap="tap";c.pan="pan";c.panStart="panstart";c.panEnd="panend";c.scale="scale";c.scaleStart="scalestart";c.scaleEnd="scaleend";c.swipe="swipe"})(jQuery,Formstone);
// Dropdown
(function(n,h,r){function w(a){for(var b="",k=0,e=0,d=a.$allOptions.length;e<d;e++){var f=a.$allOptions.eq(e),g=[];if("OPTGROUP"===f[0].tagName)g.push(c.group),f.is(":disabled")&&g.push(c.disabled),b+='<span class="'+g.join(" ")+'">'+f.attr("label")+"</span>";else{var h=f.val();f.attr("value")||f.attr("value",h);g.push(c.item);f.hasClass(c.item_placeholder)&&g.push(c.item_placeholder);f.is(":selected")&&g.push(c.item_selected);f.is(":disabled")&&g.push(c.item_disabled);b+='<button type="button" class="'+
g.join(" ")+'" ';b+='data-value="'+h+'">';b+=n("<span></span>").text(x(f.text(),a.trim)).html();b+="</button>";k++}}a.$items=a.$wrapper.html(b).find(l.item)}function B(a){p.killEvent(a);a=a.data;if(!a.disabled)if(a.mobile||!h.isMobile||h.isFirefoxMobile)a.closed?y(a):m(a);else if(a=a.$el[0],z.createEvent){var b=z.createEvent("MouseEvents");b.initMouseEvent("mousedown",!1,!0,u,0,0,0,0,0,!1,!1,!1,!1,0,null);a.dispatchEvent(b)}else a.fireEvent&&a.fireEvent("onmousedown")}function y(a){if(a.closed){n(l.base).not(a.$dropdown).trigger(d.close,
[a]);var b=a.$dropdown.offset(),k=t.outerHeight(),e=a.$wrapper.outerHeight(!0);0<=a.index&&a.$items.eq(a.index).position();b.top+e>k&&a.$dropdown.addClass(c.bottom);t.on(a.clickGUID,":not("+l.options+")",a,C);a.$dropdown.addClass(c.open);A(a);a.closed=!1}}function m(a){a&&!a.closed&&(t.off(a.clickGUID),a.$dropdown.removeClass([c.open,c.bottom].join(" ")),a.closed=!0)}function C(a){p.killEvent(a);var b=a.data;b&&0===n(a.currentTarget).parents(l.base).length&&m(b)}function D(a){(a=a.data)&&m(a)}function E(a){p.killEvent(a);
var b=n(this);a=a.data;a.disabled||(a.$wrapper.is(":visible")&&(b=a.$items.index(b),b!==a.index&&(q(b,a),v(a))),a.multiple||m(a))}function F(a,b){var c=n(this),e=a.data;b||e.multiple||(c=e.$options.index(e.$options.filter("[value='"+G(c.val())+"']")),q(c,e),v(e))}function H(a){p.killEvent(a);a=a.data;if(!a.disabled&&!a.multiple)a.$dropdown.addClass(c.focus).on(a.keyDownGUID,a,I)}function J(a,b){p.killEvent(a);var k=a.data;k.$dropdown.removeClass(c.focus).off(k.keyDownGUID);k.multiple||m(k)}function I(a){var b=
a.data;if(13===a.keyCode)b.closed||(m(b),q(b.index,b)),v(b);else if(9!==a.keyCode&&!(a.metaKey||a.altKey||a.ctrlKey||a.shiftKey)){p.killEvent(a);var c=b.$items.length-1,e=0>b.index?0:b.index;if(-1<n.inArray(a.keyCode,h.isFirefox?[38,40,37,39]:[38,40]))e+=38===a.keyCode||h.isFirefox&&37===a.keyCode?-1:1,0>e&&(e=0),e>c&&(e=c);else{a=String.fromCharCode(a.keyCode).toUpperCase();var d,f;for(f=b.index+1;f<=c;f++)if(d=b.$options.eq(f).text().charAt(0).toUpperCase(),d===a){e=f;break}if(0>e||e===b.index)for(f=
0;f<=c;f++)if(d=b.$options.eq(f).text().charAt(0).toUpperCase(),d===a){e=f;break}}0<=e&&(q(e,b),A(b))}}function q(a,b){var d=b.$items.eq(a),e=b.$options.eq(a),h=d.hasClass(c.item_selected);d.hasClass(c.item_disabled)||(b.multiple?h?(e.prop("selected",null),d.removeClass(c.item_selected)):(e.prop("selected",!0),d.addClass(c.item_selected)):-1<a&&a<b.$items.length?(e=e.data("label")||d.html(),b.$selected.html(e).removeClass(l.item_placeholder),b.$items.filter(l.item_selected).removeClass(c.item_selected),
b.$el[0].selectedIndex=a,d.addClass(c.item_selected),b.index=a):""!==b.label&&b.$selected.html(b.label))}function A(a){var b=a.$items.eq(a.index),b=0<=a.index&&!b.hasClass(l.item_placeholder)?b.position():{left:0,top:0};a.$wrapper.scrollTop(a.$wrapper.scrollTop()+b.top)}function v(a){if(a.links){var b=a.$el.val();a.external?u.open(b):u.location.href=b}else a.$el.trigger(d.raw.change,[!0])}function x(a,b){return 0===b?a:a.length>b?a.substring(0,b)+"...":a}function G(a){return"string"===typeof a?a.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,
"\\$1"):a}r=h.Plugin("dropdown",{widget:!0,defaults:{cover:!1,customClass:"",label:"",external:!1,links:!1,mobile:!1,trim:0},methods:{_setup:function(){t=h.$body},_construct:function(a){a.multiple=this.prop("multiple");a.disabled=this.is(":disabled");a.multiple?a.links=!1:a.external&&(a.links=!0);var b=this.find(":selected").not(":disabled"),k=b.text(),b=this.find("option").index(b);a.multiple||""===a.label?a.label="":(b=this.prepend('<option value="" class="'+c.item_placeholder+'" selected>'+a.label+
"</option>"),k=a.label,b=0);var e=this.find("option, optgroup"),m=e.filter("option");a.tabIndex=this[0].tabIndex;this[0].tabIndex=-1;var f=[c.base,a.customClass];a.mobile||h.isMobile?f.push(c.mobile):a.cover&&f.push(c.cover);a.multiple&&f.push(c.multiple);a.disabled&&f.push(c.disabled);var f='<div class="'+f.join(" ")+'" tabindex="'+a.tabIndex+'"></div>',g="";a.multiple||(g+='<button type="button" class="'+c.selected+'">',g+=n("<span></span>").text(x(k,a.trim)).html(),g+="</button>");g+='<div class="'+
c.options+'">';g+="</div>";this.wrap(f).after(g);a.$dropdown=this.parent(l.base);a.$allOptions=e;a.$options=m;a.$selected=a.$dropdown.find(l.selected);a.$wrapper=a.$dropdown.find(l.options);a.$placeholder=a.$dropdown.find(l.placeholder);a.index=-1;a.guid=K++;a.closed=!0;a.keyDownGUID=d.keyDown+a.guid;a.clickGUID=d.click+a.guid;w(a);a.multiple||q(b,a);a.$selected.touch({tap:!0}).on(d.tap,a,B);a.$dropdown.on(d.click,l.item,a,E).on(d.close,a,D);this.on(d.change,a,F);h.isMobile||(a.$dropdown.on(d.focus,
a,H).on(d.blur,a,J),this.on(d.focus,a,function(a){a.data.$dropdown.trigger(d.raw.focus)}))},_destruct:function(a){a.$dropdown.hasClass(c.open)&&a.$selected.trigger(d.click);a.$el[0].tabIndex=a.tabIndex;a.$dropdown.off(d.namespace);a.$options.off(d.namespace);a.$placeholder.remove();a.$selected.remove();a.$wrapper.remove();a.$el.off(d.namespace).show().unwrap()},disable:function(a,b){if("undefined"!==typeof b){var k=a.$items.index(a.$items.filter("[data-value="+b+"]"));a.$items.eq(k).addClass(c.item_disabled);
a.$options.eq(k).prop("disabled",!0)}else a.$dropdown.hasClass(c.open)&&a.$selected.trigger(d.click),a.$dropdown.addClass(c.disabled),a.$el.prop("disabled",!0),a.disabled=!0},enable:function(a,b){if("undefined"!==typeof b){var d=a.$items.index(a.$items.filter("[data-value="+b+"]"));a.$items.eq(d).removeClass(c.item_disabled);a.$options.eq(d).prop("disabled",!1)}else a.$dropdown.removeClass(c.disabled),a.$el.prop("disabled",!1),a.disabled=!1},update:function(a){var b=a.index;a.$allOptions=a.$el.find("option, optgroup");
a.$options=a.$allOptions.filter("option");a.index=-1;b=a.$options.index(a.$options.filter(":selected"));w(a);a.multiple||q(b,a)},open:y,close:m},classes:"cover bottom multiple mobile open disabled focus selected options group item item_disabled item_selected item_placeholder".split(" "),events:{tap:"tap",close:"close"}});var l=r.classes,c=l.raw,d=r.events,p=r.functions,K=0,u=h.window,z=h.document,t=null})(jQuery,Formstone);
// Upload
(function(n,h,m){function r(a){a.stopPropagation();a.preventDefault();a.data.$input.trigger(c.click)}function t(a){a.stopPropagation();a.preventDefault();a=a.data;var b=a.$input[0].files;b.length&&p(a,b)}function u(a){a.stopPropagation();a.preventDefault();a.data.$el.addClass(e.dropping)}function v(a){a.stopPropagation();a.preventDefault();a.data.$el.addClass(e.dropping)}function w(a){a.stopPropagation();a.preventDefault();a.data.$el.removeClass(e.dropping)}function x(a){a.preventDefault();var b=
a.data;a=a.originalEvent.dataTransfer.files;b.$el.removeClass(e.dropping);p(b,a)}function p(a,b){for(var f=[],d=0;d<b.length;d++){var g={index:a.total++,file:b[d],name:b[d].name,size:b[d].size,started:!1,complete:!1,error:!1,transfer:null};f.push(g);a.queue.push(g)}a.uploading||(q.on(c.beforeUnload,function(){return a.leave}),a.uploading=!0);a.$el.trigger(c.start,[f]);k(a)}function k(a){var b=0,f=[],d;for(d in a.queue)!a.queue.hasOwnProperty(d)||a.queue[d].complete||a.queue[d].error||f.push(a.queue[d]);
a.queue=f;for(var g in a.queue)if(a.queue.hasOwnProperty(g)){if(!a.queue[g].started){f=new FormData;f.append(a.postKey,a.queue[g].file);for(var e in a.postData)a.postData.hasOwnProperty(e)&&f.append(e,a.postData[e]);y(a,a.queue[g],f)}b++;if(b>=a.maxQueue)return;d++}0===b&&(q.off(c.beforeUnload),a.uploading=!1,a.$el.trigger(c.complete))}function y(a,b,e){b.size>=a.maxSize?(b.error=!0,a.$el.trigger(c.fileError,[b,"Too large"]),k(a)):(b.started=!0,b.transfer=n.ajax({url:a.action,data:e,type:"POST",contentType:!1,
processData:!1,cache:!1,xhr:function(){var d=n.ajaxSettings.xhr();d.upload&&d.upload.addEventListener("progress",function(d){var e=0,f=d.loaded||d.position,h=d.total;d.lengthComputable&&(e=Math.ceil(f/h*100));a.$el.trigger(c.fileProgress,[b,e])},!1);return d},beforeSend:function(d){a.$el.trigger(c.fileStart,[b])},success:function(d,e,f){b.complete=!0;a.$el.trigger(c.fileComplete,[b,d]);k(a)},error:function(d,e,f){b.error=!0;a.$el.trigger(c.fileError,[b,f]);k(a)}}))}m=h.Plugin("upload",{widget:!0,
defaults:{customClass:"",action:"",label:"Drag and drop files or click to select",leave:"You have uploads pending, are you sure you want to leave this page?",maxQueue:2,maxSize:5242880,postData:{},postKey:"file"},classes:["input","target","multiple","dropping"],methods:{_construct:function(a){if(h.support.file){var b;b=""+('<div class="'+e.target+'">');b+=a.label;b=b+"</div>"+('<input class="'+e.input+'" type="file"');1<a.maxQueue&&(b+=" "+e.multiple);b+=">";this.addClass(e.base).append(b);a.$input=
this.find(l.input);a.queue=[];a.total=0;a.uploading=!1;this.on(c.click,l.target,a,r).on(c.dragEnter,a,u).on(c.dragOver,a,v).on(c.dragLeave,a,w).on(c.drop,l.target,a,x);a.$input.on(c.change,a,t)}},_destruct:function(a){h.support.file&&(a.$input.off(c.namespace),this.off([c.click,c.dragEnter,c.dragOver,c.dragLeave,c.drop].join(" ")).removeClass(e.base).html(""))}}});var l=m.classes,e=l.raw,c=m.events,q=h.$window;c.complete="complete";c.fileStart="filestart";c.fileProgress="fileprogress";c.fileComplete=
"filecomplete";c.fileError="fileerror";c.start="start"})(jQuery,Formstone);
